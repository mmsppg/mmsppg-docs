---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getReports } from '../../lib/directus';

let reports = [];
let error = null;

try {
  reports = await getReports();
} catch (e) {
  error = e.message;
  console.error("Error loading reports:", e);
}

function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-GB', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
  });
}
---

<BaseLayout>
  <div class="relative">
    <!-- Header -->
    <div class="relative mb-12 pb-8 border-b-2 border-[#5B9085]/20">
      <div class="absolute inset-0 bg-gradient-to-r from-[#5B9085]/5 to-[#529F44]/5 rounded-2xl -z-10"></div>
      <div class="flex items-center gap-4 mb-4">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-[#5B9085] to-[#529F44] flex items-center justify-center shadow-lg">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <div>
          <h2 class="text-5xl font-bold text-[#596175] tracking-tight">Committee Reports</h2>
          <p class="text-lg text-[#305A65]/70 mt-2">Minutes, summaries, and documentation</p>
        </div>
      </div>
    </div>

    {error ? (
      <div class="p-8 bg-red-50 border border-red-200 rounded-lg text-red-600">
        Error loading reports: {error}
      </div>
    ) : reports.length === 0 ? (
      <div class="flex flex-col items-center justify-center py-20 px-4">
        <div class="w-20 h-20 bg-[#5B9085]/10 rounded-full flex items-center justify-center mb-6">
          <svg class="w-10 h-10 text-[#5B9085]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <p class="text-xl text-[#305A65] font-medium">No reports available yet.</p>
      </div>
    ) : (
      <div class="grid grid-cols-1 gap-6">
        {reports.map((report, index) => (
          <a
            href={`/reports/${report.slug}`}
            key={report.id}
            class="group relative bg-white rounded-xl p-6 shadow-md hover:shadow-xl transition-all duration-300 border border-[#5B9085]/20 hover:border-[#5B9085]/40 hover:-translate-y-1"
            style={`animation: fadeInUp 0.5s ease-out ${index * 0.1}s both;`}
          >
            <!-- Date badge -->
            <div class="absolute top-6 right-6">
              <div class="px-3 py-1 bg-[#5B9085]/10 rounded-full text-sm font-medium text-[#5B9085]">
                {formatDate(report.date)}
              </div>
            </div>

            <!-- Content -->
            <div class="pr-32">
              <h3 class="text-2xl font-bold text-[#596175] mb-3 group-hover:text-[#5B9085] transition-colors">
                {report.title}
              </h3>

              {report.author && (
                <div class="flex items-center gap-2 text-sm text-[#305A65] mb-4">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  <span>By {report.author.first_name} {report.author.last_name}</span>
                </div>
              )}

              <div class="text-[#305A65] line-clamp-2">
                {report.content ? report.content.replace(/<[^>]*>/g, '').substring(0, 150) : ''}...
              </div>

              <!-- Read more -->
              <div class="mt-4 flex items-center gap-2 text-[#5B9085] font-medium group-hover:gap-3 transition-all">
                <span>Read full report</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    )}
  </div>
</BaseLayout>

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>